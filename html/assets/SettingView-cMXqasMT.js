import{d as G,i as ie,r as A,j as q,k as j,a as t,l as ye,n as _e,m as se,h as Ue,x as de,y as me,c as Ve,f as ve,w as T,F as Oe,o as Ae,b as K,t as fe,v as Le}from"./index-zZCFLZ11.js";import{C as Xe}from"./index-55z86Umy.js";import{B as Ye}from"./index-iqyuMG62.js";import{c as re,H as Be,b as Ze,q as ce,I as $,n as ne,s as oe,J as B,E as Ee,L as Se,e as Ce,T as ge,K as Ne,t as O,M as Ie,a as E,N as he,m as N,w as je,f as Me,r as H,P as $e,O as He,Q as W,R as Pe,i as We,h as ee,S as Ge,U as Je,p as xe,V as ke,W as qe,X as Re,Y as Ke,Z as Qe,$ as ea,a0 as aa,a1 as oa,a2 as ta,a3 as te,a4 as la,a5 as na,C as ia,_ as sa}from"./_plugin-vue_export-helper-5FnNDvxe.js";import{F as ra}from"./index-rzXRHUq0.js";import{S as ca}from"./index-HSX_429G.js";import{T as ua}from"./index-tR9qsMEz.js";import{I as ue}from"./index-YeEeOT41.js";/* empty css              */import{T as da}from"./TabView-QRqBeXqu.js";import{a as ma,S as va}from"./index-SG0VCoox.js";import{F as fa}from"./index-rL8kCyEs.js";const we=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),ga=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),le=re("image-preview")[1],pe=2.6,ha={src:String,show:Boolean,active:Number,minZoom:$(ne),maxZoom:$(ne),rootWidth:$(Number),rootHeight:$(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickOverlay:Boolean};var wa=G({props:ha,emits:["scale","close","longPress"],setup(e,{emit:i,slots:n}){const a=ie({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),g=Be(),c=A(),C=A(),h=A(!1),f=A(!1);let _=0;const s=q(()=>{const{scale:l,moveX:r,moveY:v,moving:k,zooming:R,initializing:L}=a,J={transitionDuration:R||k||L?"0s":".3s"};return(l!==1||f.value)&&(J.transform=`matrix(${l}, 0, 0, ${l}, ${r}, ${v})`),J}),d=q(()=>{if(a.imageRatio){const{rootWidth:l,rootHeight:r}=e,v=h.value?r/a.imageRatio:l;return Math.max(0,(a.scale*v-l)/2)}return 0}),p=q(()=>{if(a.imageRatio){const{rootWidth:l,rootHeight:r}=e,v=h.value?r:l*a.imageRatio;return Math.max(0,(a.scale*v-r)/2)}return 0}),w=(l,r)=>{var v;if(l=B(l,+e.minZoom,+e.maxZoom+1),l!==a.scale){const k=l/a.scale;if(a.scale=l,r){const R=Ce((v=c.value)==null?void 0:v.$el),L={x:R.width*.5,y:R.height*.5},J=a.moveX-(r.x-R.left-L.x)*(k-1),Fe=a.moveY-(r.y-R.top-L.y)*(k-1);a.moveX=B(J,-d.value,d.value),a.moveY=B(Fe,-p.value,p.value)}else a.moveX=0,a.moveY=f.value?_:0;i("scale",{scale:l,index:e.active})}},S=()=>{w(1)},X=()=>{const l=a.scale>1?1:2;w(l,l===2||f.value?{x:g.startX.value,y:g.startY.value}:void 0)};let z,U,I,m,D,x,Y,M,o=!1;const u=l=>{const{touches:r}=l;if(z=r.length,z===2&&e.disableZoom)return;const{offsetX:v}=g;g.start(l),U=a.moveX,I=a.moveY,M=Date.now(),o=!1,a.moving=z===1&&(a.scale!==1||f.value),a.zooming=z===2&&!v.value,a.zooming&&(m=a.scale,D=we(r))},P=l=>{const{touches:r}=l;if(g.move(l),a.moving){const{deltaX:v,deltaY:k}=g,R=v.value+U,L=k.value+I;if((R>d.value||R<-d.value)&&!o&&g.isHorizontal()){a.moving=!1;return}o=!0,oe(l,!0),a.moveX=B(R,-d.value,d.value),a.moveY=B(L,-p.value,p.value)}if(a.zooming&&(oe(l,!0),r.length===2)){const v=we(r),k=m*v/D;x=ga(r),w(k,x)}},y=l=>{var r;if(z>1)return;const{offsetX:v,offsetY:k}=g,R=Date.now()-M,L=250;if(v.value<ge&&k.value<ge)if(R<L)if(e.doubleScale)if(Y)clearTimeout(Y),Y=null,X();else{if(!e.closeOnClickOverlay&&l.target===((r=C.value)==null?void 0:r.$el))return;Y=setTimeout(()=>{i("close"),Y=null},L)}else i("close");else R>Ne&&i("longPress")},F=l=>{let r=!1;if((a.moving||a.zooming)&&(r=!0,a.moving&&U===a.moveX&&I===a.moveY&&(r=!1),!l.touches.length)){a.zooming&&(a.moveX=B(a.moveX,-d.value,d.value),a.moveY=B(a.moveY,-p.value,p.value),a.zooming=!1),a.moving=!1,U=0,I=0,m=1,a.scale<1&&S();const v=+e.maxZoom;a.scale>v&&w(v,x)}oe(l,r),y(l),g.reset()},V=()=>{const{rootWidth:l,rootHeight:r}=e,v=r/l,{imageRatio:k}=a;h.value=a.imageRatio>v&&k<pe,f.value=a.imageRatio>v&&k>=pe,f.value&&(_=(k*l-r)/2,a.moveY=_,a.initializing=!0,Ee(()=>{a.initializing=!1})),S()},ae=l=>{const{naturalWidth:r,naturalHeight:v}=l.target;a.imageRatio=v/r,V()};return j(()=>e.active,S),j(()=>e.show,l=>{l||S()}),j(()=>[e.rootWidth,e.rootHeight],V),Ze("touchmove",P,{target:q(()=>{var l;return(l=C.value)==null?void 0:l.$el})}),ce({resetScale:S}),()=>{const l={loading:()=>t(Se,{type:"spinner"},null)};return t(ma,{ref:C,class:le("swipe-item"),onTouchstartPassive:u,onTouchend:F,onTouchcancel:F},{default:()=>[n.image?t("div",{class:le("image-wrap")},[n.image({src:e.src})]):t(ue,{ref:c,src:e.src,fit:"contain",class:le("image",{vertical:h.value}),style:s.value,onLoad:ae},l)]})}}});const[pa,Z]=re("image-preview"),ba=["show","teleport","transition","overlayStyle","closeOnPopstate"],ya={show:Boolean,loop:O,images:Ie(),minZoom:E(1/3),maxZoom:E(3),overlay:O,closeable:Boolean,showIndex:O,className:he,closeIcon:N("clear"),transition:String,beforeClose:Function,doubleScale:O,overlayClass:he,overlayStyle:Object,swipeDuration:E(300),startPosition:E(0),showIndicators:Boolean,closeOnPopstate:O,closeOnClickOverlay:O,closeIconPosition:N("top-right"),teleport:[String,Object]};var Te=G({name:pa,props:ya,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:i,slots:n}){const a=A(),g=A(),c=ie({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),C=()=>{if(a.value){const m=Ce(a.value.$el);c.rootWidth=m.width,c.rootHeight=m.height,a.value.resize()}},h=m=>i("scale",m),f=m=>i("update:show",m),_=()=>{Pe(e.beforeClose,{args:[c.active],done:()=>f(!1)})},s=m=>{m!==c.active&&(c.active=m,i("change",m))},d=()=>{if(e.showIndex)return t("div",{class:Z("index")},[n.index?n.index({index:c.active}):`${c.active+1} / ${e.images.length}`])},p=()=>{if(n.cover)return t("div",{class:Z("cover")},[n.cover()])},w=()=>{c.disableZoom=!0},S=()=>{c.disableZoom=!1},X=()=>t(va,{ref:a,lazyRender:!0,loop:e.loop,class:Z("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:s,onDragEnd:S,onDragStart:w},{default:()=>[e.images.map((m,D)=>t(wa,{ref:x=>{D===c.active&&(g.value=x)},src:m,show:e.show,active:c.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:c.rootWidth,rootHeight:c.rootHeight,disableZoom:c.disableZoom,doubleScale:e.doubleScale,closeOnClickOverlay:e.closeOnClickOverlay,onScale:h,onClose:_,onLongPress:()=>i("longPress",{index:D})},{image:n.image}))]}),z=()=>{if(e.closeable)return t(W,{role:"button",name:e.closeIcon,class:[Z("close-icon",e.closeIconPosition),He],onClick:_},null)},U=()=>i("closed"),I=(m,D)=>{var x;return(x=a.value)==null?void 0:x.swipeTo(m,D)};return ce({resetScale:()=>{var m;(m=g.value)==null||m.resetScale()},swipeTo:I}),ye(C),j([je,Me],C),j(()=>e.startPosition,m=>s(+m)),j(()=>e.show,m=>{const{images:D,startPosition:x}=e;m?(s(+x),_e(()=>{C(),I(+x,{immediate:!0})})):i("close",{index:c.active,url:D[c.active]})}),()=>t($e,se({class:[Z(),e.className],overlayClass:[Z("overlay"),e.overlayClass],onClosed:U,"onUpdate:show":f},H(e,ba)),{default:()=>[z(),X(),d(),p()]})}});let Q;const _a={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function Sa(){({instance:Q}=Ge({setup(){const{state:e,toggle:i}=Je(),n=()=>{e.images=[]};return()=>t(Te,se(e,{onClosed:n,"onUpdate:show":i}),null)}}))}const Ca=(e,i=0)=>{if(We)return Q||Sa(),e=Array.isArray(e)?{images:e,startPosition:i}:e,Q.open(ee({},_a,e)),Q};xe(Te);const[Ia,b,Pa]=re("uploader");function be(e,i){return new Promise(n=>{if(i==="file"){n();return}const a=new FileReader;a.onload=g=>{n(g.target.result)},i==="dataUrl"?a.readAsDataURL(e):i==="text"&&a.readAsText(e)})}function ze(e,i){return ke(e).some(n=>n.file?qe(i)?i(n.file):n.file.size>+i:!1)}function xa(e,i){const n=[],a=[];return e.forEach(g=>{ze(g,i)?a.push(g):n.push(g)}),{valid:n,invalid:a}}const ka=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg|avif)/i,Ra=e=>ka.test(e);function De(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?Ra(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}var Ta=G({props:{name:ne,item:$(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,reupload:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview","reupload"],setup(e,{emit:i,slots:n}){const a=()=>{const{status:s,message:d}=e.item;if(s==="uploading"||s==="failed"){const p=s==="failed"?t(W,{name:"close",class:b("mask-icon")},null):t(Se,{class:b("loading")},null),w=Ke(d)&&d!=="";return t("div",{class:b("mask")},[p,w&&t("div",{class:b("mask-message")},[d])])}},g=s=>{const{name:d,item:p,index:w,beforeDelete:S}=e;s.stopPropagation(),Pe(S,{args:[p,{name:d,index:w}],done:()=>i("delete")})},c=()=>i("preview"),C=()=>i("reupload"),h=()=>{if(e.deletable&&e.item.status!=="uploading"){const s=n["preview-delete"];return t("div",{role:"button",class:b("preview-delete",{shadow:!s}),tabindex:0,"aria-label":Pa("delete"),onClick:g},[s?s():t(W,{name:"cross",class:b("preview-delete-icon")},null)])}},f=()=>{if(n["preview-cover"]){const{index:s,item:d}=e;return t("div",{class:b("preview-cover")},[n["preview-cover"](ee({index:s},d))])}},_=()=>{const{item:s,lazyLoad:d,imageFit:p,previewSize:w,reupload:S}=e;return De(s)?t(ue,{fit:p,src:s.objectUrl||s.content||s.url,class:b("preview-image"),width:Array.isArray(w)?w[0]:w,height:Array.isArray(w)?w[1]:w,lazyLoad:d,onClick:S?C:c},{default:f}):t("div",{class:b("file"),style:Re(e.previewSize)},[t(W,{class:b("file-icon"),name:"description"},null),t("div",{class:[b("file-name"),"van-ellipsis"]},[s.file?s.file.name:s.url]),f()])};return()=>t("div",{class:b("preview")},[_(),a(),h()])}});const za={name:E(""),accept:N("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:E(1/0),imageFit:N("cover"),resultType:N("dataUrl"),uploadIcon:N("photograph"),uploadText:String,deletable:O,reupload:Boolean,afterRead:Function,showUpload:O,modelValue:Ie(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:O,previewOptions:Object,previewFullImage:O,maxSize:{type:[Number,String,Function],default:1/0}};var Da=G({name:Ia,props:za,emits:["delete","oversize","clickUpload","closePreview","clickPreview","clickReupload","update:modelValue"],setup(e,{emit:i,slots:n}){const a=A(),g=[],c=A(-1),C=A(!1),h=(o=e.modelValue.length)=>({name:e.name,index:o}),f=()=>{a.value&&(a.value.value="")},_=o=>{if(f(),ze(o,e.maxSize))if(Array.isArray(o)){const u=xa(o,e.maxSize);if(o=u.valid,i("oversize",u.invalid,h()),!o.length)return}else{i("oversize",o,h());return}if(o=ie(o),c.value>-1){const u=[...e.modelValue];u.splice(c.value,1,o),i("update:modelValue",u),c.value=-1}else i("update:modelValue",[...e.modelValue,...ke(o)]);e.afterRead&&e.afterRead(o,h())},s=o=>{const{maxCount:u,modelValue:P,resultType:y}=e;if(Array.isArray(o)){const F=+u-P.length;o.length>F&&(o=o.slice(0,F)),Promise.all(o.map(V=>be(V,y))).then(V=>{const ae=o.map((l,r)=>{const v={file:l,status:"",message:"",objectUrl:URL.createObjectURL(l)};return V[r]&&(v.content=V[r]),v});_(ae)})}else be(o,y).then(F=>{const V={file:o,status:"",message:"",objectUrl:URL.createObjectURL(o)};F&&(V.content=F),_(V)})},d=o=>{const{files:u}=o.target;if(e.disabled||!u||!u.length)return;const P=u.length===1?u[0]:[].slice.call(u);if(e.beforeRead){const y=e.beforeRead(P,h());if(!y){f();return}if(ea(y)){y.then(F=>{s(F||P)}).catch(f);return}}s(P)};let p;const w=()=>i("closePreview"),S=o=>{if(e.previewFullImage){const u=e.modelValue.filter(De),P=u.map(y=>(y.objectUrl&&!y.url&&y.status!=="failed"&&(y.url=y.objectUrl,g.push(y.url)),y.url)).filter(Boolean);p=Ca(ee({images:P,startPosition:u.indexOf(o),onClose:w},e.previewOptions))}},X=()=>{p&&p.close()},z=(o,u)=>{const P=e.modelValue.slice(0);P.splice(u,1),i("update:modelValue",P),i("delete",o,h(u))},U=o=>{C.value=!0,c.value=o,_e(()=>M())},I=()=>{C.value||(c.value=-1),C.value=!1},m=(o,u)=>{const P=["imageFit","deletable","reupload","previewSize","beforeDelete"],y=ee(H(e,P),H(o,P,!0));return t(Ta,se({item:o,index:u,onClick:()=>i(e.reupload?"clickReupload":"clickPreview",o,h(u)),onDelete:()=>z(o,u),onPreview:()=>S(o),onReupload:()=>U(u)},H(e,["name","lazyLoad"]),y),H(n,["preview-cover","preview-delete"]))},D=()=>{if(e.previewImage)return e.modelValue.map(m)},x=o=>i("clickUpload",o),Y=()=>{if(e.modelValue.length>=+e.maxCount&&!e.reupload)return;const o=e.modelValue.length>=+e.maxCount&&e.reupload,u=e.readonly?null:t("input",{ref:a,type:"file",class:b("input"),accept:e.accept,capture:e.capture,multiple:e.multiple&&c.value===-1,disabled:e.disabled,onChange:d,onClick:I},null);return n.default?de(t("div",{class:b("input-wrapper"),onClick:x},[n.default(),u]),[[me,!o]]):de(t("div",{class:b("upload",{readonly:e.readonly}),style:Re(e.previewSize),onClick:x},[t(W,{name:e.uploadIcon,class:b("upload-icon")},null),e.uploadText&&t("span",{class:b("upload-text")},[e.uploadText]),u]),[[me,e.showUpload&&!o]])},M=()=>{a.value&&!e.disabled&&a.value.click()};return Ue(()=>{g.forEach(o=>URL.revokeObjectURL(o))}),ce({chooseFile:M,closeImagePreview:X}),Qe(()=>e.modelValue),()=>t("div",{class:b()},[t("div",{class:b("wrapper",{disabled:e.disabled})},[D(),Y()])])}});const Fa=xe(Da),Ua={class:"info"},Va={class:"tags"},Oa=G({__name:"SettingView",setup(e){const i=async h=>{console.log("上传头像"),oa({message:"上传中...",forbidClick:!0,loadingType:"spinner",duration:0});const f=new FormData;f.append("smfile",h.file);const _=await ta.post("/image",f,{headers:{"Content-Type":"multipart/form-data",Authorization:"EbGJXCofcjs7WYDGf1KN5p6JuxJew8pJ"}}),s=_.data;if(s.success){console.log(_);const d=s.data.url;n.value.avatar=d}else n.value.avatar=s.images;te("上传头像成功"),console.log(_)},n=A({id:0,username:"",phone:"",password:"",avatar:"https://img.yzcdn.cn/vant/leaf.jpg",regtime:"2023-01-01",status:2}),a=["封号中","普通用户","VIP用户"],g=async()=>{console.log("获取用户信息");const h=await aa();h&&(n.value=h,console.log(n.value))},c=async()=>{console.log(n.value),await la(n.value)?te("更新成功"):na("更新失败")},C=()=>{confirm(`您确定要退出登录吗？
 会清空所有数据!`)&&(localStorage.removeItem("token"),te("帐号已退出"),Le.push("/login"))};return ye(()=>{g()}),(h,f)=>{const _=ue,s=Fa,d=ua,p=ca,w=ra,S=ia,X=Ye,z=fa,U=Xe;return Ae(),Ve(Oe,null,[ve("div",Ua,[t(p,{direction:"vertical",fill:"",align:"center",size:"2rem"},{default:T(()=>[t(s,{"after-read":i,"max-count":1},{default:T(()=>[t(_,{round:"",width:"30vw",height:"30vw",fit:"cover",src:n.value.avatar,class:"avatar-img"},null,8,["src"])]),_:1}),ve("div",Va,[t(p,null,{default:T(()=>[t(d,{type:"primary",round:"",plain:""},{default:T(()=>[K(fe(a[n.value.status]),1)]),_:1}),t(d,{type:"warning",round:"",plain:""},{default:T(()=>[K(fe(n.value.regtime),1)]),_:1})]),_:1})]),t(U,{inset:""},{default:T(()=>[t(z,{onSubmit:c},{default:T(()=>[t(S,null,{default:T(()=>[t(w,{modelValue:n.value.username,"onUpdate:modelValue":f[0]||(f[0]=I=>n.value.username=I),name:"name",label:"用户名",placeholder:"不修改用户名请留空"},null,8,["modelValue"]),t(w,{modelValue:n.value.phone,"onUpdate:modelValue":f[1]||(f[1]=I=>n.value.phone=I),name:"phone",label:"电话",placeholder:"不修改电话请留空"},null,8,["modelValue"]),t(w,{modelValue:n.value.password,"onUpdate:modelValue":f[2]||(f[2]=I=>n.value.password=I),type:"password",name:"password",label:"密码",placeholder:"不修改密码请留空"},null,8,["modelValue"])]),_:1}),t(S,null,{default:T(()=>[t(p,{direction:"vertical",fill:""},{default:T(()=>[t(X,{block:"",color:"rgb(65, 145, 255)","native-type":"submit",onClick:c},{default:T(()=>[K(" 保存信息 ")]),_:1}),t(X,{block:"",type:"default",onClick:C},{default:T(()=>[K("退出登录")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),t(da)],64)}}}),Wa=sa(Oa,[["__scopeId","data-v-90602369"]]);export{Wa as default};

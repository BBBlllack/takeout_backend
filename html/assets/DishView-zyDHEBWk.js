import{d as se,r as v,j as ue,a as s,c as k,b as l,w as t,F as z,o as g,g as p,e as u,t as B,u as S,n as ce,k as N,l as T,m as I,E as x,q as de,s as re,v as ie,p as pe,f as _e,_ as me}from"./index-Xpy_FskK.js";import{g as fe,a as ve,b as ge,u as ye,d as L,e as be,c as he}from"./index-pTBkHeYb.js";const j=C=>(pe("data-v-508d6900"),C=C(),_e(),C),Ce={class:"card_head"},Ve={class:"card_body"},ke={style:{"font-size":"1.2rem"}},xe=["src"],we={style:{"text-align":"center"}},De=j(()=>p("br",null,null,-1)),ze=j(()=>p("br",null,null,-1)),Be={class:"card_bottom"},Se=["id"],Te=["src"],Ue=se({__name:"DishView",setup(C){const y=v(!1),U=v(""),$=v([{label:"售卖",status:1},{label:"下架",status:0}]),V=v({}),F=async()=>{console.log("refresh category list");const o=await fe();V.value=o,console.log(V.value)},M=async o=>{I.success("上传中..."),console.log("上传头像"),console.log(o);const a=new FormData;a.append("smfile",o.file);const m=await ge.post("/image",a,{headers:{"Content-Type":"multipart/form-data",Authorization:"EbGJXCofcjs7WYDGf1KN5p6JuxJew8pJ"}}),b=m.data;if(b.success){console.log(m);const d=b.data.url;n.value.cover=d}else n.value.cover=b.images;I.success("头像上传成功")},O=async()=>{console.log("submit!"),y.value=!await ye(n.value),_()},n=v({}),h=v([]);function q(){U.value="菜品添加",y.value=!0,n.value={}}function A(o){U.value="菜品编辑",y.value=!0,n.value={},n.value.cid=o.cid,n.value.cover=o.cover,n.value.descr=o.descr,n.value.discount=o.discount,n.value.id=o.id,n.value.name=o.name,n.value.price=o.price,n.value.status=o.status}function G(o){console.log("删除"+JSON.stringify(o)),x.confirm("确认删除该菜品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await L([o.id])&&_()})}const w=v(""),c=v({current:1,size:5,total:0}),K=o=>{console.log(`keyword: ${o}`),_()},P=async o=>{console.log(`current page: ${o}`),c.value.current=o,_()},W=o=>{console.log(`selected: ${JSON.stringify(o)}`),h.value=o.map(a=>a.id),console.log(`selectedDish: ${JSON.stringify(h.value)}`)},X=async()=>{console.log("批量删除"),x.confirm("确认删除选中菜品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await L(h.value)&&_()})},Y=async()=>{console.log("批量启售"),x.confirm("确认启售选中菜品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await be(h.value)&&_()})},H=async()=>{console.log("批量停售"),x.confirm("确认停售选中菜品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await he(h.value)&&_()})},_=async()=>{console.log("获取菜品列表");const o=await ve(c.value.current,c.value.size,w.value);c.value=o};return ue(()=>{_(),F()}),(o,a)=>{const m=s("el-input"),b=s("el-col"),d=s("el-button"),Q=s("el-row"),r=s("el-table-column"),R=s("el-tag"),Z=s("el-table"),ee=s("el-pagination"),le=s("el-card"),f=s("el-form-item"),E=s("el-option"),J=s("el-select"),te=s("el-icon"),ae=s("el-upload"),oe=s("el-form"),ne=s("el-drawer");return g(),k(z,null,[l(le,{class:"card"},{default:t(()=>[p("div",Ce,[l(Q,null,{default:t(()=>[l(b,{span:12},{default:t(()=>[l(m,{size:"large","prefix-icon":"Search",style:{width:"20vw"},autocomlpete:"off",placeholder:"请输入菜品名称",onInput:K,modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=e=>w.value=e)},null,8,["modelValue"])]),_:1}),l(b,{span:12,style:{"text-align":"right"}},{default:t(()=>[l(d,{size:"large",type:"danger",onClick:a[1]||(a[1]=e=>X())},{default:t(()=>[u("批量删除")]),_:1}),l(d,{size:"large",type:"success",onClick:a[2]||(a[2]=e=>Y())},{default:t(()=>[u(" 批量启售")]),_:1}),l(d,{size:"large",type:"danger",onClick:a[3]||(a[3]=e=>H())},{default:t(()=>[u("批量停售")]),_:1}),l(d,{size:"large",type:"primary",onClick:q},{default:t(()=>[u("+添加菜品")]),_:1})]),_:1})]),_:1})]),p("div",Ve,[l(Z,{data:c.value.records,style:{width:"100%"},border:"",onSelectionChange:W},{default:t(()=>[l(r,{type:"selection"}),l(r,{prop:"name",label:"名称"},{default:t(({row:e})=>[p("div",ke,B(e.name),1)]),_:1}),l(r,{prop:"cover",label:"图片"},{default:t(({row:e})=>[p("img",{src:e.cover,style:{width:"100%",height:"100%","border-radius":"5px"}},null,8,xe)]),_:1}),l(r,{prop:"descr",label:"简介"}),l(r,{prop:"category",label:"分类"},{default:t(({row:e})=>{var i;return[u(B((i=V.value.records.find(D=>D.id===e.cid))==null?void 0:i.name),1)]}),_:1}),l(r,{prop:"price",label:"售价"}),l(r,{prop:"discount",label:"折扣"}),l(r,{prop:"status",label:"售卖状态"},{default:t(({row:e})=>[l(R,{size:"large",type:e.status===1?"success":"danger",effect:"dark"},{default:t(()=>{var i;return[u(B((i=$.value.find(D=>D.status===e.status))==null?void 0:i.label),1)]}),_:2},1032,["type"])]),_:1}),l(r,{label:"操作"},{default:t(({row:e})=>[p("div",we,[l(d,{icon:S(de),type:"primary",onClick:i=>A(e)},{default:t(()=>[u("编辑")]),_:2},1032,["icon","onClick"]),De,ze,l(d,{icon:S(re),type:"danger",onClick:i=>G(e)},{default:t(()=>[u("删除")]),_:2},1032,["icon","onClick"])])]),_:1})]),_:1},8,["data"])]),p("div",Be,[l(ee,{"current-page":c.value.current,"onUpdate:currentPage":a[4]||(a[4]=e=>c.value.current=e),"page-size":c.value.size,"onUpdate:pageSize":a[5]||(a[5]=e=>c.value.size=e),layout:"total, prev, pager, next, jumper",total:c.value.total,onCurrentChange:P},null,8,["current-page","page-size","total"])])]),_:1}),l(ne,{modelValue:y.value,"onUpdate:modelValue":a[13]||(a[13]=e=>y.value=e),"show-close":!1},{header:t(({titleId:e,titleClass:i})=>[p("h4",{id:e,class:ce(i)},"菜品添加",10,Se)]),default:t(()=>[l(oe,{model:n.value,"label-width":"120px","label-position":"left"},{default:t(()=>[l(f,{label:"菜品名称"},{default:t(()=>[l(m,{modelValue:n.value.name,"onUpdate:modelValue":a[6]||(a[6]=e=>n.value.name=e),"prefix-icon":"Dish",placeholder:"朗朗上口名经传"},null,8,["modelValue"])]),_:1}),l(f,{label:"菜品分类"},{default:t(()=>[l(J,{modelValue:n.value.cid,"onUpdate:modelValue":a[7]||(a[7]=e=>n.value.cid=e),placeholder:"选择分类"},{default:t(()=>[(g(!0),k(z,null,N(V.value.records,e=>(g(),T(E,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"菜品图片"},{default:t(()=>[l(ae,{class:"avatar-uploader","show-file-list":!1,"http-request":M},{default:t(()=>[n.value.cover?(g(),k("img",{key:0,src:n.value.cover,class:"avatar-uploader-img"},null,8,Te)):(g(),T(te,{key:1,class:"avatar-uploader-icon"},{default:t(()=>[l(S(ie))]),_:1}))]),_:1})]),_:1}),l(f,{label:"菜品价格"},{default:t(()=>[l(m,{modelValue:n.value.price,"onUpdate:modelValue":a[8]||(a[8]=e=>n.value.price=e),"prefix-icon":"Coin",type:"number",placeholder:"作价几许？"},{append:t(()=>[u("元")]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"菜品状态"},{default:t(()=>[l(J,{modelValue:n.value.status,"onUpdate:modelValue":a[9]||(a[9]=e=>n.value.status=e),placeholder:"选择状态"},{default:t(()=>[(g(!0),k(z,null,N($.value,e=>(g(),T(E,{key:e.status,label:e.label,value:e.status},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"菜品折扣"},{default:t(()=>[l(m,{modelValue:n.value.discount,"onUpdate:modelValue":a[10]||(a[10]=e=>n.value.discount=e),"prefix-icon":"Discount",placeholder:"来即是客，我打个折"},{append:t(()=>[u("%")]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"菜品简介"},{default:t(()=>[l(m,{modelValue:n.value.descr,"onUpdate:modelValue":a[11]||(a[11]=e=>n.value.descr=e),type:"textarea",placeholder:"给食客一句话的考虑时间"},null,8,["modelValue"])]),_:1}),l(f,null,{default:t(()=>[l(d,{type:"primary",onClick:O},{default:t(()=>[u("提交")]),_:1}),l(d,{onClick:a[12]||(a[12]=e=>y.value=!1)},{default:t(()=>[u("取消")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Je=me(Ue,[["__scopeId","data-v-508d6900"]]);export{Je as default};
